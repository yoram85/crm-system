#!/bin/bash
# Auto-generated fix script for Google OAuth
# Generated by diagnose_oauth.py

echo "ğŸ”§ ×ª×™×§×•×Ÿ Google OAuth Configuration"
echo "====================================="
echo ""

# 1. Check .env.local
if [ ! -f .env.local ]; then
    echo "âŒ .env.local ×œ× ×§×™×™× - ×™×•×¦×¨ ×-.env.local.example"
    cp .env.local.example .env.local
    echo "âœ… × ×•×¦×¨ .env.local"
    echo "âš ï¸  ×¢×¨×•×š ××ª ×”×§×•×‘×¥ ×•×”×•×¡×£ ××ª ×”×¢×¨×›×™× ×-Supabase Dashboard"
    exit 1
fi

# 2. Validate environment variables
if ! grep -q "supabase.co" .env.local; then
    echo "âŒ VITE_SUPABASE_URL ×œ× ××•×’×“×¨ ×‘-.env.local"
    echo "×”×•×¡×£: VITE_SUPABASE_URL=https://ohgjascuewpmgukajvjd.supabase.co"
fi

# 3. Build the project
echo "ğŸ”¨ Building project..."
npm run build

if [ $? -eq 0 ]; then
    echo "âœ… Build ×”×¦×œ×™×—"
else
    echo "âŒ Build × ×›×©×œ - ×‘×“×•×§ ×©×’×™××•×ª"
    exit 1
fi

# 4. Instructions for Netlify
echo ""
echo "ğŸ“ ×¦×¢×“×™× ×™×“× ×™×™× × ×“×¨×©×™×:"
echo "========================"
echo ""
echo "1ï¸âƒ£  Supabase Dashboard:"
echo "   â†’ https://supabase.com/dashboard/project/ohgjascuewpmgukajvjd/auth/providers"
echo "   â†’ ×•×“× ×©-Google Provider ××•×¤×¢×œ"
echo ""
echo "2ï¸âƒ£  Supabase Redirect URLs:"
echo "   â†’ https://supabase.com/dashboard/project/ohgjascuewpmgukajvjd/auth/url-configuration"
echo "   â†’ ×”×•×¡×£:"
echo "      â€¢ https://rachel.woretaw.net"
echo "      â€¢ https://rachel.woretaw.net/"
echo "      â€¢ http://localhost:5173"
echo ""
echo "3ï¸âƒ£  Google Cloud Console:"
echo "   â†’ https://console.cloud.google.com/apis/credentials"
echo "   â†’ Authorized JavaScript origins:"
echo "      â€¢ https://ohgjascuewpmgukajvjd.supabase.co"
echo "   â†’ Authorized redirect URIs:"
echo "      â€¢ https://ohgjascuewpmgukajvjd.supabase.co/auth/v1/callback"
echo ""
echo "4ï¸âƒ£  Netlify Environment Variables:"
echo "   â†’ https://app.netlify.com â†’ Site settings â†’ Environment variables"
echo "   â†’ ×”×•×¡×£:"
echo "      â€¢ VITE_SUPABASE_URL = https://ohgjascuewpmgukajvjd.supabase.co"
echo "      â€¢ VITE_SUPABASE_ANON_KEY = (×”×¢×ª×§ ×-Supabase)"
echo ""
echo "5ï¸âƒ£  Netlify Deploy:"
echo "   â†’ Deploys â†’ Trigger deploy â†’ Clear cache and deploy site"
echo ""
echo "âœ… ×¡×™×™××ª ××ª ×›×œ ×”×©×œ×‘×™×? × ×¡×” ×œ×”×ª×—×‘×¨ ×©×•×‘!"
